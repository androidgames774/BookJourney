<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reading Progress Tracker</title>

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3b82f6">

  <!-- React & Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: sans-serif; background: #f3f4f6; margin: 0; padding: 20px; }
    .card { background: white; padding: 16px; border-radius: 16px; margin-bottom: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .progress-bar { background: #e5e7eb; border-radius: 9999px; height: 16px; width: 100%; margin-right: 8px; }
    .progress { background: #22c55e; height: 16px; border-radius: 9999px; }
    input { border: 1px solid #d1d5db; padding: 4px 8px; border-radius: 8px; width: 60px; }
    button { padding: 6px 12px; border-radius: 8px; border: none; cursor: pointer; }
    .btn-add { background: #3b82f6; color: white; }
    .btn-save { background: #16a34a; color: white; width: 100%; }
    .btn-delete { background: none; color: #ef4444; text-decoration: underline; cursor: pointer; }
  </style>
</head>
<body>
  <h1 style="text-align:center; margin-bottom:20px;">ðŸ“š Reading Progress Tracker</h1>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [books, setBooks] = useState(() => {
        const saved = localStorage.getItem("books");
        return saved ? JSON.parse(saved) : [];
      });
      const [title, setTitle] = useState("");
      const [totalPages, setTotalPages] = useState("");
      const [showAddForm, setShowAddForm] = useState(false);
      const [showBreakdown, setShowBreakdown] = useState(false);
      const [selectedBookId, setSelectedBookId] = useState(null);

      useEffect(() => {
        localStorage.setItem("books", JSON.stringify(books));
      }, [books]);

      const addBook = () => {
        if (!title || !totalPages) return;
        const newBook = {
          id: Date.now(),
          title,
          totalPages: Number(totalPages),
          readPages: 0,
        };
        const updateProgress = (id, readPages) => {
  setBooks(books.map(book => {
    if (book.id === id) {
      const pages = Number(readPages);
      let log = Array.isArray(book.readingLog) ? [...book.readingLog] : [];
      const today = getToday();
      const prevLogEntry = log.find(l => l.date === today);
      if (prevLogEntry) {
        prevLogEntry.pages = pages;
      } else {
        log.push({ date: today, pages });
      }
      return { ...book, readPages: pages, readingLog: log };
    }
    return book;
  }));
};
        setBooks([...books, newBook]);
        setTitle("");
        setTotalPages("");
        setShowAddForm(false);
      };

      const updateProgress = (id, readPages) => {
        setBooks(
          books.map((book) =>
            book.id === id ? { ...book, readPages: Number(readPages) } : book
          )
        );
      };

      const showDailyBreakdown = (bookId) => {
  setSelectedBookId(bookId);
  setShowBreakdown(true);
};

const goBack = () => {
  setShowBreakdown(false);
  setSelectedBookId(null);
};

      const deleteBook = (id) => {
        setBooks(books.filter((book) => book.id !== id));
      };

      return (
        <div>
         {books.map((book) => {
  const progress = Math.min((book.readPages / book.totalPages) * 100, 100).toFixed(1);
  function getToday() {
  return new Date().toISOString().slice(0,10);
}

function DailyBreakdown({ book, goBack }) {
  if (!book) return <div>Book not found. <button onClick={goBack}>Back</button></div>;
  // Prepare daily log (fill in missing days)
  let log = Array.isArray(book.readingLog) ? [...book.readingLog] : [];
  if (log.length === 0) {
    log.push({ date: getToday(), pages: book.readPages });
  }
  const startDate = log[0].date;
  const endDate = getToday();
  const dayList = [];
  let d = new Date(startDate);
  while (d.toISOString().slice(0,10) <= endDate) {
    const dateStr = d.toISOString().slice(0,10);
    const found = log.find(l => l.date === dateStr);
    dayList.push({ date: dateStr, pages: found ? found.pages : 0 });
    d.setDate(d.getDate() + 1);
  }
  return (
    <div>
      <button className="btn-add" onClick={goBack}>&larr; Back to Dashboard</button>
      <h2>{book.title} Daily Progress</h2>
      {dayList.map(day => {
        const dailyPercent = book.readPages ? (day.pages / book.readPages) * 100 : 0;
        return (
          <div style={{
            background: 'white', padding: '12px', borderRadius: '10px', marginBottom: '10px',
            boxShadow: '0 1px 2px rgba(0,0,0,0.06)', display:'flex', alignItems:'center', justifyContent:'space-between'
          }} key={day.date}>
            <span style={{width:"100px"}}>{day.date}</span>
            <div style={{background:"#e5e7eb", borderRadius:"9999px", height:"12px", width:"120px", margin:"0 8px", display:"inline-block"}}>
              <div style={{background:"#22c55e", height:"100%", borderRadius:"9999px", width: `${dailyPercent}%`}}></div>
            </div>
            <span>{day.pages} pages</span>
          </div>
        );
      })}
    </div>
  );
}
            
  return (
  <div>
    {!showBreakdown ? (
      <>
        {/* Book cards as above */}
        {books.map(...)} {/* Use the updated book card code above */}
        {/* Add book form as before */}
        <div style={{ marginTop: '16px' }}>
          <div style={{ textAlign: 'center', marginBottom: '8px' }}>
            <button className="btn-add" onClick={() => setShowAddForm(!showAddForm)}>
              {showAddForm ? "Close Add Book" : "Add a New Book"}
            </button>
          </div>
          {showAddForm && (
            <div className="card" style={{ maxWidth: '400px', margin: '0 auto' }}>
              <input type="text" placeholder="Book Title" value={title} onChange={(e) => setTitle(e.target.value)} style={{ width: '100%', marginBottom: '8px' }} />
              <input type="number" placeholder="Total Pages" value={totalPages} onChange={(e) => setTotalPages(e.target.value)} style={{ width: '100%', marginBottom: '8px' }} />
              <button className="btn-save" onClick={addBook}>Save Book</button>
            </div>
          )}
        </div>
      </>
    ) : (
      <DailyBreakdown 
        book={books.find(b => b.id === selectedBookId)} 
        goBack={goBack}
      />
    )}
  </div>
);
})}

          <div style={{ marginTop: '16px' }}>
            <div style={{ textAlign: 'center', marginBottom: '8px' }}>
              <button className="btn-add" onClick={() => setShowAddForm(!showAddForm)}>
                {showAddForm ? "Close Add Book" : "Add a New Book"}
              </button>
            </div>
            {showAddForm && (
              <div className="card" style={{ maxWidth: '400px', margin: '0 auto' }}>
                <input type="text" placeholder="Book Title" value={title} onChange={(e) => setTitle(e.target.value)} style={{ width: '100%', marginBottom: '8px' }} />
                <input type="number" placeholder="Total Pages" value={totalPages} onChange={(e) => setTotalPages(e.target.value)} style={{ width: '100%', marginBottom: '8px' }} />
                <button className="btn-save" onClick={addBook}>Save Book</button>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);

    // PWA: register a simple service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register(URL.createObjectURL(new Blob([`
        const CACHE_NAME = 'reading-tracker-cache-v1';
        const urlsToCache = ['/'];
        self.addEventListener('install', event => event.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))));
        self.addEventListener('fetch', event => event.respondWith(caches.match(event.request).then(r => r || fetch(event.request))));
      `], {type: 'application/javascript'})));
    }

  </script>

  <!-- PWA manifest inlined -->
   <script type="application/manifest+json">
  {
    "name": "Reading Progress Tracker",
    "short_name": "ReadingTracker",
    "start_url": ".",
    "display": "standalone",
    "background_color": "#f3f4f6",
    "theme_color": "#3b82f6",
    "icons": [
      {
        "src": "/icons/books-192.png",
        "sizes": "192x192",
        "type": "image/png"
      },
      {
        "src": "/icons/books-512.png",
        "sizes": "512x512",
        "type": "image/png"
      }
    ]
  }
  </script>

</body>
</html>
